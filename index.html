<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Project Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* fallback dark */
    @media (prefers-color-scheme: dark) {
      :root { color-scheme: dark; }
    }
  </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900 dark:bg-gray-950 dark:text-gray-100">
  <div class="max-w-6xl mx-auto p-6">
    <!-- Header -->
    <header class="flex items-center justify-between gap-3 mb-6">
      <div>
        <h1 class="text-2xl font-bold">Projects</h1>
        <p class="text-sm text-gray-600 dark:text-gray-400">A collection of small tools & demos</p>
      </div>
      <button id="themeBtn" class="rounded-xl px-3 py-2 text-sm border border-gray-200 dark:border-gray-800">
        ‚òÄÔ∏è / üåô
      </button>
    </header>

    <!-- Controls -->
    <section class="flex flex-col md:flex-row md:items-center gap-3 mb-5">
      <input id="search" class="w-full md:w-80 border rounded-xl px-3 py-2 bg-white dark:bg-gray-900 dark:border-gray-800"
             placeholder="Search projects..." aria-label="Search projects" />
      <div id="tags" class="flex flex-wrap gap-2"></div>
    </section>

    <!-- Grid -->
    <section id="grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></section>

    <!-- Footer -->
    <footer class="mt-10 text-xs text-gray-500 dark:text-gray-400">
      Powered by GitHub Pages. Add projects via <code>projects.json</code>.
    </footer>
  </div>

  <script>
    // ---------- Theme toggle ----------
    const themeBtn = document.getElementById('themeBtn');
    const setTheme = (t) => {
      if (t === 'dark') document.documentElement.classList.add('dark');
      else document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', t);
    };
    themeBtn.addEventListener('click', () => {
      const cur = localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      setTheme(cur === 'dark' ? 'light' : 'dark');
    });
    setTheme(localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));

    // ---------- Data load ----------
    const FALLBACK_PROJECTS = [
      {
        title: "Garage Inventory ‚Äî Voice ‚Üí AI ‚Üí Airtable",
        slug: "garage-inventory-helper",
        description: "Dictate a rant, AI splits & cleans items, pushes to Airtable via Worker/Zap.",
        demo: "./garage-inventory-helper/",     // or external Worker/UI
        repo: "https://github.com/itsnatemcm/garage-inventory-helper",
        cover: "assets/demo.gif",
        tags: ["AI", "Airtable", "Cloudflare", "Web"]
      },
      {
        title: "Another Project",
        slug: "another-project",
        description: "Short one-liner about what it does.",
        demo: "./another-project/",
        repo: "https://github.com/itsnatemcm/another-project",
        cover: "",
        tags: ["Tool"]
      }
    ];

    async function loadProjects() {
      try {
        const res = await fetch('./projects.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('no projects.json');
        return await res.json();
      } catch {
        return FALLBACK_PROJECTS;
      }
    }

    // ---------- Render ----------
    const grid = document.getElementById('grid');
    const tagsEl = document.getElementById('tags');
    const searchEl = document.getElementById('search');

    let allProjects = [];
    let activeTag = null;

    const tagBtn = (t) => {
      const b = document.createElement('button');
      b.className = 'px-3 py-1 rounded-full text-xs border border-gray-200 dark:border-gray-800 hover:bg-gray-100 dark:hover:bg-gray-900';
      b.textContent = t;
      b.addEventListener('click', () => {
        activeTag = activeTag === t ? null : t;
        render();
      });
      return b;
    };

    function render() {
      const query = (searchEl.value || '').toLowerCase().trim();
      let list = allProjects.slice();

      if (activeTag) list = list.filter(p => (p.tags || []).map(x=>x.toLowerCase()).includes(activeTag.toLowerCase()));
      if (query) {
        list = list.filter(p =>
          (p.title||'').toLowerCase().includes(query) ||
          (p.description||'').toLowerCase().includes(query) ||
          (p.tags||[]).some(t => t.toLowerCase().includes(query))
        );
      }

      grid.innerHTML = '';
      if (!list.length) {
        grid.innerHTML = `<div class="col-span-full text-sm text-gray-500 dark:text-gray-400">No projects match your filters.</div>`;
        return;
      }

      for (const p of list) {
        const aDemo = p.demo ? `<a href="${p.demo}" class="px-3 py-2 rounded-lg bg-black text-white text-sm" target="_blank" rel="noopener">Open</a>` : '';
        const aRepo = p.repo ? `<a href="${p.repo}" class="px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-800 text-sm" target="_blank" rel="noopener">Repo</a>` : '';

        const cover = p.cover
          ? `<img src="${p.cover}" alt="" class="w-full h-36 object-cover rounded-xl border border-gray-100 dark:border-gray-800">`
          : `<div class="w-full h-36 rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-900 dark:to-gray-800 border border-gray-100 dark:border-gray-800"></div>`;

        const tags = (p.tags||[]).map(t => `<span class="px-2 py-0.5 rounded-full text-[10px] border border-gray-200 dark:border-gray-800">${t}</span>`).join(' ');

        const card = document.createElement('article');
        card.className = 'bg-white dark:bg-gray-900 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 p-3 flex flex-col gap-3';
        card.innerHTML = `
          ${cover}
          <div class="flex-1">
            <h3 class="font-semibold text-base mb-1">${p.title}</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${p.description||''}</p>
            <div class="flex flex-wrap gap-1">${tags}</div>
          </div>
          <div class="flex gap-2">${aDemo}${aRepo ? ' ' + aRepo : ''}</div>
        `;
        grid.appendChild(card);
      }
    }

    // ---------- Init ----------
    loadProjects().then(projects => {
      allProjects = projects;
      // Build tag cloud
      const tagSet = new Set();
      projects.forEach(p => (p.tags||[]).forEach(t => tagSet.add(t)));
      tagsEl.innerHTML = '';
      if (tagSet.size) {
        const allBtn = tagBtn('All');
        allBtn.addEventListener('click', () => { activeTag = null; render(); });
        allBtn.classList.add('bg-gray-100','dark:bg-gray-900');
        tagsEl.appendChild(allBtn);
        for (const t of Array.from(tagSet).sort()) tagsEl.appendChild(tagBtn(t));
      }
      render();
    });
    searchEl.addEventListener('input', render);
  </script>
</body>
</html>
